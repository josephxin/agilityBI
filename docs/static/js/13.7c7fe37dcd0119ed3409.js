webpackJsonp([13],{"/l4L":function(e,t,o){"use strict";var r=o("3cXf"),n=o.n(r),i=o("4YfN"),l=o.n(i),a=o("R4Sj"),s=o("jt1B"),c={components:{},props:{dialogTitle:{type:String},newFolderId:{type:Number},flagDelete:{type:Boolean},flagUpdate:{type:Boolean},list:{type:Array}},data:function(){return{folderActive:-1,folderId:0,folderName:"",reportContent:[],collectForm:{name:""},activeNames:[1],collectList:[{name:"本地收藏夹"}],visibleNewFolder:!1,visiblePopover:!1,newFolderName:"新建文件夹",changeFolderName:"",preventConflict:!0}},computed:l()({},Object(a.c)(["reportId","reportName","currFolderId","chartArr","echartsData"])),watch:{reportName:{handler:function(e,t){this.collectForm.name=e}},list:{handler:function(e,t){this.list.length>0&&(this.folderActive=0,this.folderId=this.list[this.folderActive].id,this.folderName=this.list[this.folderActive].name)}},newFolderId:{handler:function(e,t){var o=this;this.list.unshift({name:this.newFolderName,id:e,toggle:"true",hasfile:0}),setTimeout(function(){o.$refs.collectFolder.$el.scrollTop=0})}},flagDelete:{handler:function(e,t){this.list.splice(this.folderActive,1),Object(s.a)({type:"success",message:"删除成功!"})}},flagUpdate:{handler:function(e,t){this.list[this.folderActive].name=this.changeFolderName,Object(s.a)({type:"success",message:"修改成功!"})}}},methods:{selectFolder:function(e,t){this.folderActive=e,this.folderId=t.id,this.folderName=t.name},appearFolderMenu:function(e,t,o){var r=this;this.folderActive=t,this.folderId=o.id,this.folderName=o.name,this.changeFolderName=o.name,this.visiblePopover=!0,this.$refs.popover.style.left=e.x+"px",this.$refs.popover.style.top=e.y+"px",setTimeout(function(){r.$refs.popover.focus()})},modifyFolder:function(){var e=this;this.list[this.folderActive].toggle="",setTimeout(function(){e.$refs.changeFolderName[0].select()})},deleteFolder:function(){var e=this;this.visiblePopover=!1,1==this.list[this.folderActive].hasfile?this.$confirm("此文件夹包含 文件，确定要删除此文件夹吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$emit("delete-event",e.folderId)}).catch(function(){Object(s.a)({message:"已取消删除"})}):this.$emit("delete-event",this.folderId)},appearNewFolder:function(){var e=this;this.visibleNewFolder=!0,this.newFolderName="新建文件夹",setTimeout(function(){e.$refs.newFolderName[0].select(),e.$refs.collectFolder.$el.scrollTop=0})},createNewFolder:function(e){var t=this;this.preventConflict&&("keyup"==e.type&&(this.preventConflict=!1,setTimeout(function(){t.preventConflict=!0})),""==this.newFolderName&&(this.newFolderName="新建文件夹"),this.visibleNewFolder=!1,this.$emit("add-event",this.newFolderName))},changeFolder:function(e,t){var o=this;this.preventConflict&&("keyup"==e.type&&(this.preventConflict=!1,setTimeout(function(){o.preventConflict=!0})),""!=this.changeFolderName&&this.changeFolderName!=t.name&&this.$emit("update-event",{id:t.id,name:this.changeFolderName}),t.toggle="true")},collectConfirmFn:function(){var e=this;if(0!=this.folderId){this.$root.dialogCollect=!1,this.reportContent.length=0,this.chartArr.forEach(function(t,o){e.reportContent.push(e.echartsData[t])});var t=document.querySelector("#main-content");this.$h2c(t).then(function(t){var o=t.toDataURL("image/png");"添加收藏"==e.dialogTitle?e.$emit("save-report",{folderid:e.folderId,foldername:e.folderName,reportName:e.collectForm.name,reportContent:n()(e.reportContent),reportUrl:o}):"保存"==e.dialogTitle&&(e.folderId==e.currFolderId?e.$emit("update-report",{id:e.reportId,reportName:e.collectForm.name,reportContent:n()(e.reportContent),reportUrl:o}):e.$emit("save-report",{folderid:e.folderId,foldername:e.folderName,reportName:e.collectForm.name,reportContent:n()(e.reportContent),reportUrl:o}))}).catch(function(e){console.log(e)})}else Object(s.a)({type:"warning",message:"请选择一个文件夹!"})}},created:function(){},mounted:function(){this.collectForm.name=this.reportName}},d={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{staticClass:"dialogCollect",attrs:{title:e.dialogTitle,visible:e.$root.dialogCollect},on:{"update:visible":function(t){return e.$set(e.$root,"dialogCollect",t)}}},[o("div",{staticClass:"el-dialog-content"},[o("el-form",{ref:"collectForm",staticClass:"collect-form",attrs:{model:e.collectForm,"label-width":"59px","label-position":"left"},nativeOn:{submit:function(e){e.preventDefault()}}},[o("el-form-item",{attrs:{label:"名称"}},[o("el-input",{staticClass:"collect-name fl",attrs:{placeholder:"请输入名称"},model:{value:e.collectForm.name,callback:function(t){e.$set(e.collectForm,"name",t)},expression:"collectForm.name"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"文件夹"}},[o("div",{staticClass:"collect-folder"},[o("el-collapse",{ref:"collectFolder",model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},e._l(e.collectList,function(t,r){return o("el-collapse-item",{key:r,attrs:{name:r+1}},[o("template",{slot:"title"},[o("p",{attrs:{title:t.name}},[o("i",{staticClass:"iconfont icon-shoucang1"}),e._v(" "),o("span",[e._v(e._s(t.name))])])]),e._v(" "),e.visibleNewFolder?o("div",{staticClass:"item"},[o("i",{staticClass:"iconfont icon-wenjianjia fl"}),e._v(" "),o("el-input",{ref:"newFolderName",refInFor:!0,staticClass:"new-folder__input fl",on:{blur:function(t){return e.createNewFolder(t)}},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.createNewFolder(t)}},model:{value:e.newFolderName,callback:function(t){e.newFolderName=t},expression:"newFolderName"}})],1):e._e(),e._v(" "),o("transition-group",{attrs:{name:"slide",tag:"div"}},e._l(e.list,function(t,r){return o("div",{key:t.id,staticClass:"item transition",class:{active:e.folderActive==r},attrs:{title:t.name},on:{click:function(o){return e.selectFolder(r,t)},contextmenu:function(o){return o.preventDefault(),e.appearFolderMenu(o,r,t)}}},[o("i",{staticClass:"iconfont icon-wenjianjia fl"}),e._v(" "),t.toggle?o("span",{staticClass:"fl"},[e._v(e._s(t.name))]):e._e(),e._v(" "),t.toggle?e._e():o("el-input",{ref:"changeFolderName",refInFor:!0,staticClass:"new-folder__input fl",on:{blur:function(o){return e.changeFolder(o,t)}},nativeOn:{keyup:function(o){return!o.type.indexOf("key")&&e._k(o.keyCode,"enter",13,o.key,"Enter")?null:e.changeFolder(o,t)}},model:{value:e.changeFolderName,callback:function(t){e.changeFolderName=t},expression:"changeFolderName"}})],1)}),0)],2)}),1),e._v(" "),o("div",{staticClass:"create-collect-folder",on:{click:e.appearNewFolder}},[o("i",{staticClass:"iconfont icon-xinjianwenjianjia"}),e._v(" "),o("span",[e._v("新建文件夹")])]),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:e.visiblePopover,expression:"visiblePopover"}],ref:"popover",staticClass:"popover",attrs:{tabindex:"-1"},on:{blur:function(t){e.visiblePopover=!1}}},[o("p",{staticClass:"transition",on:{click:e.modifyFolder}},[e._v("修改")]),e._v(" "),o("p",{staticClass:"transition",on:{click:e.deleteFolder}},[e._v("删除")])])],1)])],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer clearfix",attrs:{slot:"footer"},slot:"footer"},[o("button",{staticClass:"fr dialog-confirm",attrs:{type:"button"},on:{click:e.collectConfirmFn}},[e._v("确 定")])])])},staticRenderFns:[]};var f=o("C7Lr")(c,d,!1,function(e){o("NVD8")},null,null);t.a=f.exports},NVD8:function(e,t){},PHFc:function(e,t){},yH2u:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o("aA9S"),n=o.n(r),i=o("4YfN"),l=o.n(i),a=o("R4Sj"),s=o("mpDc"),c=o("/l4L"),d=o("ufMx"),f=o("jt1B"),h=o("gyMJ"),u=o("aozt"),m=o.n(u),p={components:{echartsRight:s.a,dialogCollect:c.a,dialogExport:d.a},data:function(){var e=this;return{storeFolderList:[],newStoreFolderId:0,flagDelete:!0,flagUpdate:!0,buttons:[{name:"制作报告",iconName:"icon-zhizuo",fn:function(){e.goProduceReport()}},{name:"收藏",iconName:"icon-shoucang3",fn:function(){e.collectReport()}},{name:"导出",iconName:"icon-daochu",fn:function(){e.$root.exportEcharts()}}],buttons2:[],routeId:"0"}},computed:l()({},Object(a.c)(["flagHeight","currFolderId","reportId","reportName","mySeekSwitch","visibleCollectBtn","token"])),watch:{mySeekSwitch:{handler:function(e){var t=this;e&&""!=this.token&&setTimeout(function(){t.reportSearchHistorySaveAjax()},1500)}},visibleCollectBtn:{handler:function(e){this.buttons2=this.buttons}}},methods:{goProduceReport:function(){if("0"==this.routeId||"3"==this.routeId)var e=[{reportName:this.reportName}];else if("1"==this.routeId||"2"==this.routeId)e=[{folderId:this.currFolderId,reportId:this.reportId,reportName:this.reportName}];this.$store.commit("changeReportList",e),this.$router.push({name:"produceReport",params:{id:this.routeId}})},confirmExport:function(e){this.$root.confirmExport(e)},collectReport:function(){""!=this.token?this.$root.dialogCollect=!0:Object(f.a)({message:"请先登录",type:"warning"})},addStoreFolder:function(e){var t=this;Object(h.T)({name:e}).then(function(e){200==e.code&&(t.newStoreFolderId=e.data.id)}).catch(function(e){console.log(e)})},deleteStoreFolder:function(e){var t=this;Object(h.R)({id:e}).then(function(e){200==e.code&&(t.flagDelete=!t.flagDelete)}).catch(function(e){console.log(e)})},updateStoreFolder:function(e){var t=this;Object(h.U)({id:e.id,name:e.name}).then(function(e){200==e.code&&(t.flagUpdate=!t.flagUpdate)}).catch(function(e){console.log(e)})},saveReport:function(e){Object(h.N)({folderId:e.folderid,folderName:e.foldername,reportName:e.reportName,storeData:e.reportContent,storeUrl:e.reportUrl}).then(function(e){200==e.code&&Object(f.a)({type:"success",duration:1e3,message:"添加收藏成功!"})}).catch(function(e){console.log(e)})},heightToggle:function(){this.flagHeight?document.getElementById("main-content").style.height="":document.getElementById("main-content").style.height="867px",this.$store.commit("changeHeight",!this.flagHeight)},reportSearchHistorySaveAjax:function(e){var t=this,o=document.querySelector("#main-content");this.$h2c(o).then(function(e){var o=e.toDataURL("image/png");Object(h.J)({searchImg:o,searchName:t.reportName}).then(function(e){}).catch(function(e){console.log(e)})})},exportData:function(){m()({method:"post",url:"http://172.16.113.24:8082/api/farmReport/exportReportInfo",data:{},responseType:"blob",headers:{Accept:"*/*",Authorization:"Bearerbe3bfe8f-1841-4725-8c32-142b3dff25f7"}}).then(function(e){console.log(e)}).catch(function(e){console.log(e)})}},created:function(){var e=this;""!=this.token&&Object(h.S)().then(function(t){if(200==t.code){var o=t.data;o.constructor==Array&&o.length>0&&(e.storeFolderList=o)}}).catch(function(e){console.log(e)})},mounted:function(){switch(this.routeId=this.$route.params.id,this.routeId){case"1":this.$store.dispatch("getStoreInfo",this.reportId);break;case"2":this.$store.dispatch("getReportInfo",this.reportId);break;case"3":this.$parent.$refs.search.getAjax(this.reportName,!0)}if("0"==this.routeId||"3"==this.routeId)this.buttons2=this.buttons;else if("1"==this.routeId||"2"==this.routeId){var e=n()([],this.buttons);e.splice(1,1),this.buttons2=e}this.$store.commit("changeVisibleBtn",!1),this.$store.commit("changeVisibleHeader",!0)},beforeDestroy:function(){this.$root.dialogCollect=!1,this.$root.dialogExportSet=!1,this.$store.commit("changeListState")}},v={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"chart"},[o("echarts-right",{attrs:{buttons:e.buttons2}}),e._v(" "),o("dialog-collect",{attrs:{dialogTitle:"添加收藏",list:e.storeFolderList,newFolderId:e.newStoreFolderId,flagDelete:e.flagDelete,flagUpdate:e.flagUpdate},on:{"add-event":e.addStoreFolder,"delete-event":e.deleteStoreFolder,"update-event":e.updateStoreFolder,"save-report":e.saveReport}}),e._v(" "),o("dialog-export",{on:{"confirm-export":e.confirmExport}})],1)},staticRenderFns:[]};var g=o("C7Lr")(p,v,!1,function(e){o("PHFc")},"data-v-b088f7c0",null);t.default=g.exports}});